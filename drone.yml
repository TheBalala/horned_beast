---
kind: pipeline
type: kubernetes
name: default

steps:

  # - name: Install dependanice 
  #   image: node:10.12.0-slim
  #   commands:
  #   - npm install
  #   - npm run build

  - name: set-environment-variables
    image: alpine
    environment:
      USERNAME: "alialhjouj"
      PASSWORD: "Alicoder1996"
      REPO: "alialhjouj/hello-world"  # Repository name including the organization/user
      TAGS: "$DRONE_BUILD_NUMBER"

  - name: debug-variables
    image: alpine
    environment:
      REPO: "$REPO"
      TAGS: "$TAGS"
    commands:
      - echo "REPO: $REPO"
      - echo "TAGS: $TAGS"

  - name: build-and-push-docker-image
    image: plugins/docker
    environment:
      DOCKER_USERNAME: "$USERNAME"
      DOCKER_PASSWORD: "$PASSWORD"
      TAGS: "$DRONE_BUILD_NUMBER"
    commands:
      - echo $TAGS
      - docker build -t $REPO:$TAGS .
      - docker login -u $DOCKER_USERNAME -p $DOCKER_PASSWORD
      - docker push $REPO:$TAGS

  # - name: build-and-push-docker-image
  #   image: plugins/docker
  #   settings:
  #     USERNAME:
  #       from_secret: USERNAME
  #     PASSWORD:
  #       from_secret: PASSWORD
  #     repo: alialhjouj/hello-world
  #     tags: 
  #       - "${TAGS}"
    
  # - name: build-docker-image
  #   image: docker:dind
  #   volumes:
  #     - name: dockersock
  #       path: /var/run
  #   settings:
  #     USERNAME:
  #       from_secret: USERNAME
  #     PASSWORD:
  #       from_secret: PASSWORD
  #   commands:
  #     - sleep 5
  #     - docker login -u alialhjouj -p Alicoder1996
  #     - docker build -t alialhjouj/$DRONE_REPO_NAME:$DRONE_BUILD_NUMBER .
  #     - docker push alialhjouj/$DRONE_REPO_NAME:$DRONE_BUILD_NUMBER

  - name: list-all-environment-variables
    image: alpine
    commands:
      - printenv









